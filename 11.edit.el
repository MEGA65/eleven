#OUTPUT "11.EDIT"LASTØYPOS=0LASTØYOFFS=0LASTØXPOS=0GOTO GENERALØINITØANDØMAINØLOOP  ' BUFFER OF PAST LINE LOCATION.DRAWØTEXTØLINE'--------------  A$=MID$(A$,XØOFFS)  B=LEN(A$)  O=B>80  PRINT "{RVOF}";  IF O THEN B=79  P=POINTER(A$)  BANK 0  M=PEEK(P+1)+256*PEEK(P+2)  C=M+B-1  IF B=0 THEN 6  IF IV=1 THEN PRINT "{RVON}";  BANK 1  FOR A = M TO C    ZA=PEEK(A)    PRINT TRANSL$(ZA);    IF IV=1 AND ZA=34 THEN PRINT "{RVON}";  NEXT  BANK 128  IF O THEN BEGIN    FOREGROUND HL    PRINT TAB(79);"$";    FOREGROUND FG  BEND  RETURN.GENERALØINITØANDØMAINØLOOP'--------------------------  TRAP ERRORØHANDLER  PALETTE RESTORE  POKE 0,65             ' M65 FAST MODE  GOSUB MLØHELPER ' INSTALL M/L  PF$="11.EDIT"  KEY 7,"SCRATCH "+CHR$(34)+PF$+CHR$(34)+":DSAVE"+CHR$(34)+PF$+CHR$(34)+":DVERIFY"+CHR$(34)+PF$+CHR$(34)  IF RWINDOW(2)<>80 THEN PRINT CHR$(27)+"X"; ' FORCE 80COLS MODE  GOSUB READØDEFAULTSØFROMØMAILBOX  BACKGROUND BG  BORDER BO  FOREGROUND FG  PRINT "{HOME}{HOME}{CLR}{SWLC}"+CHR$(27)+"M";  GOSUB CLEARØSTATUSØBAR  PRINT "{RVON} EE V0.5.0{RVOF}";  GOSUB ENABLEØRAWØFNØKEYS  MAXØLINES=2000                ' MAX NUMBER OF LINES  ESCØFLAG%=0                  ' ESCAPE FLAG  T$="                                                                               "  BLANKØLINE$=T$+T$+T$:T$=""  QUOTE$=CHR$(34)            ' FAST ACCESS TO QUOTE CHAR  FORMATØOFF$=CHR$(27)+CHR$(27)  ' ESCAPE FLASH ETC.  CTRLØCHARS$="{HOME}{CLR}{F2}{$84}{LEFT}{UP}{DOWN}{RGHT}{F1}{F3}{F5}{F7}{F4}{F8}{√‘“Ã-œ}{√‘“Ã-⁄}{√‘“Ã-–}{$83}{√‘“Ã-◊}{√‘“Ã-’}{INST}{BLU}"+CHR$(22)+CHR$(20)+CHR$(148)+CHR$(13)  ' CTRL CHARS  HORZØMOVEØCHARS$="{LEFT}{RGHT}"+CHR$(20)      ' HORIZONTAL MOVEMENT CHARACTERS  FILEØCHANGEDØIND$(0)=" ":FILEØCHANGEDØIND$(1)="*"  ' FOR FILE CHANGED INDICATOR  CONTROLØMODEØIND$(0)="    ":         ' FOR CONTROL CHAR MODE INDICATOR  CONTROLØMODEØIND$(1)="{√‘“Ã-œ}CTRL"+FORMATØOFF$  DISKØOPØRESULT$(1)="SUCCESS: ":DISKØOPØRESULT$(0)="ERROR: "  ' DISC OPERATION RESULT  DISKØOPØRESULTØCLR(1)=SB:DISKØOPØRESULTØCLR(0)=HL                  ' DISC OPERATION RESULT COLORS  DEFAULTØFILE$="11.DEFAULTS"                  ' DEFAULTS FILE NAME  DIM LINEØBUFF$(MAXØLINES)            ' LINE BUFFER  DIM CLIPBOARD$(100)         ' CLIPBOARD OF LINES  DIM LABELØNAME$(72),LABELØLINENO(72),FILTEREDØNAME$(72),FILTEREDØLINENO(72)    ' MARKER TABLE  EE$(0)="VARIABLE NOT DECLARED"' --- BUILD CHAR TRANSLATION TABLE ---  DIM TRANSL$(255)            ' CHAR TRANSLATION TABLE  FOR A=1 TO 31:TRANSL$(A)="{RVON}"+CHR$(64+A)+"{RVOF}":TRANSL$(128+A)="{RVON}"+CHR$(192+A)+"{RVOF}":NEXT A  FOR A=32 TO 127:TRANSL$(A)=CHR$(A):TRANSL$(A+128)=CHR$(A+128):NEXT A  TRANSL$(34)=CHR$(34)+FORMATØOFF$  TRANSL$(160)="{√¬Õ-+}"  ' MAKE SHIFT+SPACE VISIBLE      XØOFFS=1  ' HORIZONTAL SCROLL INDEX IN CURRENT LINE  BANK 128  POKE 248,PEEK(248)OR2^6     ' DISABLE SCREEN EDITOR LINE LINKING  XØPOS=0:YØPOS=0:STATUSØLINEØY=RWINDOW(1)-2  ' CURSOR POS, STATUS LINE POSITION  GOSUB CHECKØFILETYPE  IF CURRØFILE$<>"" THEN BEGIN    IF FILEØTYPE$<>".PRJ" AND PEEK($4FF70)=55 AND PEEK($4FF71)=77 THEN BEGIN      GOSUB COPYØATTICØRAMØTOØLINEØBUFFER    BEND:ELSE BEGIN      GOSUB LOADØFILE ' LOAD FILE IF SET      GOSUB COPYØLINEØBUFFERØTOØATTICØRAM ' KEEP COPY OF FILE IN ATTIC RAM      POKE $4FF70,55,77      IF DISKØERRNO<>0 THEN CURRØFILE$=""  ' DELETE CURRENT FILENAME IF FILE NOT THERE    BEND  BEND' UNCOMMENT THIS FOR OUTPUT PERFORMANCE TEST' TS=TI:FOR TE=0 TO 10:GOSUB 2080:NEXT TE:PRINT "{DOWN}{DOWN}{DOWN}"TI-TS:STOP  GOSUB REDRAWØSCREEN ' REDRAW SCREEN  GOSUB BUILDØSTATUSØBAR ' BUILD STATUS BAR' **********************' ** MAIN EDITOR LOOP **' **********************  BANK 128:SYS MLØV4  ' ENABLE VIC IV  IF JUMPØLINE<>-1 THEN BEGIN    LY=JUMPØLINE:CONTEXTØLINES=5:GOSUB SAFEØLY ' BRING LINE IN CONTEXT    IF PEEK($4FF30)<>0 THEN BEGIN      R=0:PARSERØERROR$="":DO:P=PEEK($4FF30+R):PARSERØERROR$=PARSERØERROR$+CHR$(P):R=R+1:LOOP WHILE P<>0      GOSUB CLEARØSTATUSØBAR:PRINT "{RVON}";PARSERØERROR$;:REDRAWØSTATUS=1      POKE $4FF30,0    BEND    JUMPØLINE=-1:CONTEXTØLINES=0              ' CLEAR JUMP LINE  BEND    DO.MAINØLOOP    IF YØPOS-YØOFFS<0 THEN YØOFFS=0:YØPOS=0    IF REDRAWØSTATUS<>1 THEN PO$="      {LEFT}{LEFT}{LEFT}{LEFT}{LEFT}{LEFT}"+MID$(STR$(XØPOS),2)+":"+MID$(STR$(YØPOS),2):GOSUB DISPLAYØSTATUS    CURRØLINE$=LINEØBUFF$(YØPOS)    IF (YØPOS-YØOFFS)>RWINDOW(1)-1 THEN YØPOS=YØOFFS+RWINDOW(1)-1    CURSOR XØPOS,YØPOS-YØOFFS    FOREGROUND SB    CURSOR ON    GET KEY T$    CURSOR OFF    FOREGROUND FG      IF MF=1 THEN GOSUB MARKØMODEØHANDLER : GOTO MAINØLOOP  ' MARK-MODE HANDLING    IF REDRAWØSTATUS=1 THEN GOSUB BUILDØSTATUSØBAR: BANK 128:SYS MLØV4: REDRAWØSTATUS=0    BANK 128:ALTØKEY = PEEK(54801) AND 16  ' CHECK ALT KEY    ' -- IF T$=F11 (ALSO CTRL+5/GREEN FOR XEMU?)    IF T$="{PUR}" OR (ALTØKEY AND T$="C") THEN CONTROLØMODE=ABS(CONTROLØMODE-1) : GOTO MAINØLOOP    CTRLØORØALT = (INSTR(CTRLØCHARS$,T$) AND CONTROLØMODE=0) OR ALTØKEY    IF CTRLØORØALT THEN BEGIN      IF T$="G" THEN T$="{√‘“Ã-–}"  ' WORKAROUND FOR CHALLENGED KEYBOARDS      IF T$="S" THEN T$="{√‘“Ã-⁄}"      IF T$=CHR$(13) THEN CHANGED=1: GOSUB INSERTØRETURN  ' INSERT RETURN      IF INSTR(HORZØMOVEØCHARS$,T$)=0 AND XØOFFS>1 THEN BEGIN        XØOFFS=1:CURSOR 0,YØPOS-YØOFFS:CURRØLINE$=LINEØBUFF$(YØPOS):A$=CURRØLINE$:GOSUB DRAWØTEXTØLINE        IF T$=CHR$(13) THEN CURSOR 0,YØPOS-YØOFFS-1:A$=LINEØBUFF$(YØPOS-1):GOSUB DRAWØTEXTØLINE      BEND      IF T$="{√‘“Ã-◊}" THEN GOSUB NEXTØWORD  ' CTRL-W = NEXT WORD      IF T$="{√‘“Ã-’}" THEN GOSUB PREVIOUSØWORD ' CTRL-U = PREVIOUS WORD      IF T$="{INST}" THEN GOSUB DELETEØCURRØCHAR ' SHIFT-DEL = DELETE CURRENT CHAR      IF T$="{BLU}" THEN POKE $4FF07,PEEK($4FF07) XOR 16:IF PEEK($4FF07)AND 16 THEN PLAY "T0O5SG"  ' TOGGLE DEBUG ON/OFF      IF T$="P" THEN GOSUB POSTØFILEØTOØPC      IF T$="Z" THEN GOSUB NAVIGATEØTOØLABELØUNDERØCURSOR      IF T$="F" THEN FR%=0 : GOSUB FINDØREPLACE  ' FIND      IF T$="R" THEN FR%=1 : GOSUB FINDØREPLACE  ' FIND AND REPLACE      IF T$="{F3}" THEN GOSUB SAVEØFILE  ' SAVE      IF T$="{F4}" THEN SA=1:GOSUB SAVEØFILE  ' SAVE AS      IF T$="{F1}" THEN GOSUB LOADØFILEØPROMPT  ' LOAD      IF T$="{$83}" THEN GOSUB QUITØEE  ' STOP      IF T$="{F2}" THEN GOSUB NEWØFILE  ' NEW      IF T$="{F7}" THEN GOSUB SHOWØLABELS  ' LABELS      IF T$="{√‘“Ã-–}" THEN GOSUB JUMPØTOØLINE  ' GOTO LINE      IF T$="{F8}" THEN GOSUB JUMPØTOØPREVØFILE  ' GO TO PREVIOUS FILE (PV$)      IF T$="{$84}" THEN GOSUB SHOWØHELP  ' HELP      IF T$="{√‘“Ã-œ}" THEN TEMP=YØPOS:YØPOS=LASTØYPOS:LASTØYPOS=TEMP: TEMP=YØOFFS:YØOFFS=LASTØYOFFS:LASTØYOFFS=TEMP: TEMP=XØPOS:XØPOS=LASTØXPOS:LASTØXPOS=TEMP:GOSUB  REDRAWØSCREEN      IF T$="{HOME}" THEN BEGIN            ' HOME/END        IF ALTØKEY=0 THEN LY=0:XØPOS=0:GOSUB SAFEØLY: ELSE LY=LASTLINEØY:XØPOS=0:GOSUB SAFEØLY      BEND      IF T$="{RGHT}" THEN BEGIN  ' -------- CURSOR RIGHT        IF ALTØKEY THEN BEGIN           IF 79+XØOFFS<LEN(CURRØLINE$) THEN XØOFFS=XØOFFS+1:CURSOR0,YØPOS-YØOFFS:A$=CURRØLINE$:GOSUB DRAWØTEXTØLINE        BEND : ELSE XØPOS=XØPOS+1        IF XØPOS>79 THEN BEGIN          XØPOS=79:IF XØPOS+XØOFFS<LEN(CURRØLINE$) THEN XØOFFS=XØOFFS+1          CURSOR 0,YØPOS-YØOFFS:A$=CURRØLINE$:GOSUB DRAWØTEXTØLINE        BEND      BEND      IF T$="{LEFT}" THEN BEGIN        IF XØPOS>0 THEN XØPOS=XØPOS-1 : ELSE IF YØPOS>0 THEN YØPOS=YØPOS-1:XØPOS=LEN(LINEØBUFF$(YØPOS)):IF XØPOS>79 THEN XØPOS=79      BEND      IF T$="{DOWN}" THEN BEGIN        IF ALTØKEY THEN LY=YØPOS+STATUSØLINEØY:GOSUB SAFEØLY:ELSE YØPOS=YØPOS+1        IF YØPOS-YØOFFS>STATUSØLINEØY-3 THEN GOSUB SCROLLØUP : IF YØPOS-YØOFFS>STATUSØLINEØY THEN YØPOS=YØPOS-1      BEND      IF T$="{UP}" THEN BEGIN        IF ALTØKEY THEN LY=YØPOS-STATUSØLINEØY:GOSUB SAFEØLY:ELSE YØPOS=YØPOS-1        IF YØPOS-YØOFFS<0 THEN GOSUB SCROLLØDOWN : IF YØPOS-YØOFFS<0 THEN YØPOS=YØPOS+1      BEND      IF T$="{F5}" THEN GOSUB COMPILE  ' --- F5 - COMPILE      IF T$=CHR$(20) THEN BEGIN ' DELETE        CHANGED=1        IF XØPOS=0 OR ALTØKEY THEN GOSUB MERGEØLINES :ELSE BEGIN  ' MERGE WITH LAST LINE          CURRØLINE$=LEFT$(CURRØLINE$,XØPOS+XØOFFS-2)+MID$(CURRØLINE$,XØPOS+XØOFFS)          LINEØBUFF$(YØPOS)=CURRØLINE$          CURSOR 0,YØPOS-YØOFFS:A$=CURRØLINE$:GOSUB DRAWØTEXTØLINE:IF LEN(CURRØLINE$)<=79 THEN PRINT " ";          IF XØPOS>0 THEN XØPOS=XØPOS-1        BEND      BEND      IF T$="{√‘“Ã-⁄}" THEN BEGIN  ' --- F14 - SAVE DEFAULTS        GOSUB CLEARØSTATUSØBAR:PRINT "{RVON}SAVING DEFAULTS...{RVOF}";        SCRATCH (DEFAULTØFILE$):BSAVE (DEFAULTØFILE$),B(4),P(DEC("FF00")) TO P(DEC("FF80"))        DISKØERRNO=DS : DISKØERROR$=DS$        FOREGROUND DISKØOPØRESULTØCLR(ABS(DISKØERRNO=0))        GOSUB CLEARØSTATUSØBAR:PRINT "{RVON}";DISKØOPØRESULT$(ABS(DISKØERRNO=0));DISKØERROR$;" ";:FOREGROUND SB        REDRAWØSTATUS=1      BEND    ' ENDIF CTRLØORØALT    BEND:ELSE BEGIN  ' ELSE NOT CTRLØORØALT      IF T$=CHR$(27) THEN BEGIN ' -- CHECK ESCAPE FLAG        T$="":IF ESCØFLAG%=0 THEN ESCØFLAG%=1:ELSE ESCØFLAG%=0      BEND:ELSE BEGIN        IF ESCØFLAG%=1 THEN BEGIN  ' -- CHECK ESCAPE CHARACTERS          IF T$="K" THEN XØPOS=LEN(CURRØLINE$):IF XØPOS>78 THEN XØOFFS=XØPOS-78:XØPOS=78:GOSUB REDRAWØLINE          IF T$="J" THEN XØPOS=0:IF XØOFFS>1 THEN XØOFFS=1:GOSUB REDRAWØLINE          IF T$="D" THEN ALTØKEY=1:GOSUB MERGEØLINES :CHANGED=1          IF T$="M" THEN MF=1:MS=YØPOS:ME=YØPOS:GOSUB REDRAWØLINE          IF T$="P" THEN GOSUB PASTE          ESCØFLAG%=0        BEND:ELSE BEGIN  ' -- INSERT CHAR          CHANGED=1          IF XØPOS=79 THEN XØOFFS=XØOFFS+1          DO WHILE LEN(CURRØLINE$)<XØPOS:CURRØLINE$=CURRØLINE$+" ":LOOP ' FILL UP SPACES IF NEEDED          CURRØLINE$=LEFT$(CURRØLINE$,XØPOS+XØOFFS-1)+T$+MID$(CURRØLINE$,XØPOS+XØOFFS)          LINEØBUFF$(YØPOS)=CURRØLINE$          CURSOR 0,YØPOS-YØOFFS:A$=CURRØLINE$:GOSUB DRAWØTEXTØLINE          XØPOS=XØPOS+1 : IF XØPOS>79 THEN XØPOS=79        BEND ' ENDIF ESCØFLAG%=1      BEND ' ENDIF T$=CHR$(27)    BEND ' ENDIF NOT CTRLØORØALT (CTRL-CHAR)  LOOP UNTIL QU=1  STOP' ==================== SUBROUTINES =====================' FILETYPE$ = FT$' PROJECTØFLAG% = PF%' PROJECTØNAME$ = PN$' PROJØFILEØIDX% = PI%' PROJØFILES$(20) = DIM PF$(20)' TOTALØPROJØLINES = TP%' FIDX = FI%.CHECKØFILEYPE'-------------  FILETYPE$ = ".EL"  IF LEN(CURRØFILE$) > 4 AND RIGHT$(CURRØFILE$, 4) = ".PRJ" THEN BEGIN    FILETYPE$ = ".PRJ"    PROJECTØFLAG% = 1  BEND  RETURN.LOADØFILE'---------  GOSUB CHECKØFILETYPE  IF FILETYPE$ = ".PRJ" THEN PROJØNAME$ = CURRØFILE$ : PROJØFILEØIDX% = 0' --- READ IN F$  OPEN 1,1,5,CURRØFILE$+",S,R":DISKØERRNO=DS:DISKØERROR$=DS$  IF DISKØERRNO<>0 THEN CURRØFILE$=OF$:CLOSE 1:RETURN  FOR A = 0 TO MAXØLINES:LINEØBUFF$(A)="":NEXT A:LC=0  LASTLINEØY=0:YØOFFS=0:YØPOS=0:XØPOS=0  DO    L$="":LINE INPUT#1,L$    LINEØBUFF$(LASTLINEØY)=L$    LASTLINEØY=LASTLINEØY+1    IF PROJECTØFLAG% AND FILETYPE$ = ".PRJ" AND LEN(L$)>0 AND LEFT$(L$,1)<>"'" THEN BEGIN      PROJØFILES$(PROJØFILEØIDX%) = L$      PROJØFILEØIDX% = PROJØFILEØIDX% + 1    BEND  LOOP WHILE ST=0  LASTLINEØY=LASTLINEØY-1:CHANGED=0  CLOSE 1  RETURN.REDRAWØSCREEN'-------------  FOREGROUND FG : PRINT "{RVOF}";  IF YØOFFS<0 THEN YØOFFS=0  FOR I=0 TO STATUSØLINEØY    CURSOR 0,I    A$=LINEØBUFF$(YØOFFS+I)    PRINT CHR$(27)+"Q";:ZY=YØPOS:YØPOS=YØOFFS+I:GOSUB INVERTØIFØMARKED :YØPOS=ZY:GOSUB DRAWØTEXTØLINE  NEXT I  RETURN.SCROLLØUP'---------  IF YØOFFS+STATUSØLINEØY>LASTLINEØY-1 THEN RETURN  YØOFFS=YØOFFS+1  ' CURRENT TOP  S$=LINEØBUFF$(YØOFFS+STATUSØLINEØY)  CURSOR 0,0:PRINT CHR$(27)+"V";  CURSOR 0,STATUSØLINEØY:A$=S$:GOSUB DRAWØTEXTØLINE  RETURN.SCROLLØDOWN'-----------  IF YØOFFS<=0 THEN RETURN  YØOFFS=YØOFFS-1  S$=LINEØBUFF$(YØOFFS)  CURSOR0,0:PRINT CHR$(27)+"W";:A$=S$:GOSUB DRAWØTEXTØLINE  RETURN.DISPLAYØSTATUS'--------------' --- DISPLAY STATUS IN ST$  FOREGROUND SB  PRINT "{HOME}{HOME}";:CURSOR 20,STATUSØLINEØY+1:PRINT "{RVON}"+PO$;  CURSOR 75,STATUSØLINEØY+1:PRINT CONTROLØMODEØIND$(CONTROLØMODE);  CURSOR 0,STATUSØLINEØY+1:PRINT "{RVON}"+FILEØCHANGEDØIND$(CHANGED)+"{RVOF}";  WINDOW 0,0,79,STATUSØLINEØY  FOREGROUND FG  RETURN.CLEARØSTATUSØBAR'----------------  IF RWINDOW(1)=25 THEN CB=2048+(24*80) : FB=$FF80000 + (24*80)  IF RWINDOW(1)=50 THEN CB=$40800+(49*80) : FB=$FF80000 + (49*80)  EDMA 3,80,160,CB        '  --- CLEAR STATUS BAR  EDMA 3,80,SB,FB         '  SET STATUS BAR COLOUR  PRINT "{HOME}{HOME}";:CURSOR 0,STATUSØLINEØY+1  FOREGROUND SB  RETURN.BUILDØSTATUSØBAR'----------------  GOSUB CLEARØSTATUSØBAR  PRINT "{HOME}{HOME}";:CURSOR 18,STATUSØLINEØY+1:PRINT "{RVON}{”»…∆‘--}       {”»…∆‘--} {RVOF}F1{RVON}LOAD {RVOF}F3{RVON}SAVE {RVOF}F5{RVON}COMPILE {RVOF}F7{RVON}LBLS {RVOF}F9{RVON}GO {RVOF}F11{RVON}CMODE {”»…∆‘--}";  CURSOR 2,STATUSØLINEØY+1:IF CURRØFILE$<>"" THEN PRINT CURRØFILE$;:ELSE PRINT "<UNTITLED>";  WINDOW 0,0,79,STATUSØLINEØY  FOREGROUND FG  RETURN.INSERTØRETURN'-------------  YØPOS=YØPOS+1  LASTLINEØY=LASTLINEØY+1  IF YØPOS>LASTLINEØY THEN LASTLINEØY=YØPOS  FORA=LASTLINEØY+1TO YØPOS+1 STEP-1:LINEØBUFF$(A)=LINEØBUFF$(A-1):NEXT A:LINEØBUFF$(YØPOS)=""  LINEØBUFF$(YØPOS)=MID$(LINEØBUFF$(YØPOS-1),XØPOS+XØOFFS)  LINEØBUFF$(YØPOS-1)=LEFT$(LINEØBUFF$(YØPOS-1),XØPOS+XØOFFS-1)  XØPOS=0:SC=1:PL$=LINEØBUFF$(YØPOS-1)  DO WHILE MID$(PL$,SC,1)=" "  ' --- AUTOINDENT    IF LINEØBUFF$(YØPOS)<>"" THEN LINEØBUFF$(YØPOS)=" "+LINEØBUFF$(YØPOS)    SC=SC+1:XØPOS=XØPOS+1  LOOP  IF YØPOS-YØOFFS>STATUSØLINEØY THEN GOSUB SCROLLØUP  ' SCROLL UP  CURSOR XØPOS,YØPOS-YØOFFS:PRINT CHR$(27)+"I";  A$=LINEØBUFF$(YØPOS):GOSUB DRAWØTEXTØLINE  CURSOR XØPOS-SC+1,YØPOS-YØOFFS-1:PRINT CHR$(27)+"Q";  A$=LINEØBUFF$(YØPOS-1):GOSUB DRAWØTEXTØLINE  RETURN.MERGEØLINES'-----------' --- MERGE LINES  IF ALTØKEY=0 AND YØPOS<1 THEN RETURN  IF ALTØKEY THEN SX=XØPOS:XØPOS=0:YØPOS=YØPOS-1:GOTO MGØSKIP  YØPOS=YØPOS-1:XØPOS=LEN(LINEØBUFF$(YØPOS))  LINEØBUFF$(YØPOS)=LINEØBUFF$(YØPOS)+LINEØBUFF$(YØPOS+1)  .MGØSKIP  FOR A=YØPOS+1 TO LASTLINEØY-1:LINEØBUFF$(A)=LINEØBUFF$(A+1):NEXT A  IF YØPOS<=LASTLINEØY THEN LINEØBUFF$(LASTLINEØY)=""  IF LASTLINEØY>0 THEN LASTLINEØY=LASTLINEØY-1    IF ALTØKEY=0 THEN CURSOR 0,YØPOS-YØOFFS:A$=LINEØBUFF$(YØPOS):GOSUB DRAWØTEXTØLINE  CURSOR 0,YØPOS-YØOFFS+1:PRINT CHR$(27)+"D";  CURSOR 0,STATUSØLINEØY:A$=LINEØBUFF$(YØOFFS+STATUSØLINEØY):GOSUB DRAWØTEXTØLINE  IF YØOFFS+STATUSØLINEØY>LASTLINEØY-1 THEN CURSOR 0,STATUSØLINEØY:PRINT CHR$(27)+"Q";  IF ALTØKEY THEN XØPOS=SX:YØPOS=YØPOS+1  RETURN.SAVEØFILE'---------  IF BU AND CURRØFILE$<>"" AND SA=0 THEN BEGIN    GOSUB CLEARØSTATUSØBAR:PRINT "{RVON}BACKING UP OLD FILE...";    B$=LEFT$(CURRØFILE$,12)+".BAK"    DELETE (B$)    COPY (CURRØFILE$) TO (B$)  BEND  IF CURRØFILE$="" OR SA=1 THEN SA=0 : GOSUB SAVEØFILEØPROMPT  ' SAVE AS  IF CURRØFILE$="" THEN GOSUB BUILDØSTATUSØBAR: RETURN  GOSUB CLEARØSTATUSØBAR:PRINT "{RVON}SAVING...";  DELETE (CURRØFILE$)  I = MAXØLINES:DO WHILE LINEØBUFF$(I)="":I=I-1:LOOP  LASTLINEØY=I  OPEN 1,1,3,CURRØFILE$+",S,W":DISKØERRNO=DS:DISKØERROR$=DS$  FOR A=0 TO LASTLINEØY    PRINT #1,LINEØBUFF$(A)  NEXT A  IF DS<>0 THEN DISKØERRNO=DS  CLOSE 1  GOSUB CLEARØSTATUSØBAR  IF DISKØERRNO=0 THEN CHANGED=0  FOREGROUND DISKØOPØRESULTØCLR(ABS(DISKØERRNO=0))  PRINT DISKØOPØRESULT$(ABS(DISKØERRNO=0));DISKØERROR$;" ";:FOREGROUND SB  GOSUB SAVEØFILENAMEØINØMAILBOX  ' SAVE FILENAME IN MAILBOX RAM  REDRAWØSTATUS=1  RETURN.LOADØFILEØPROMPT'----------------' --- LOAD FILE  GOSUB CLEARØSTATUSØBAR  OF$=CURRØFILE$  IF CHANGED=1 THEN BEGIN    PRINT "{RVON}CURRENT FILE "+CURRØFILE$+" NOT SAVED. REALLY PROCEED? (Y/N) {√‘“Ã-œ}{√¬Õ-+}"+FORMATØOFF$;    DO:GET KEY T$:LOOP UNTIL INSTR("YN",T$)    GOSUB CLEARØSTATUSØBAR    IF T$="N" THEN GOSUB BUILDØSTATUSØBAR:RETURN  BEND  GOSUB CLEARØSTATUSØBAR:PRINT "{RVON}LOAD FILE NAME ($ FOR DIRECTORY, RETURN TO CANCEL) "+CHR$(27)+"T{CLR}";  NF$=""  LINE INPUT "";NF$  IF LEN(NF$)>0 AND LEFT$(NF$,1)="$" THEN BEGIN    WINDOW0,0,79,STATUSØLINEØY : PRINT "{CLR}"; : FOREGROUND FG    IF LEN(NF$) = 1 THEN DIR : ELSE BEGIN      DIR (MID$(NF$,2))    BEND    GOTO LFØRETRY  BEND.LOADØSPECIFIEDØFILE  PRINT "{HOME}{HOME}";:GOSUB CLEARØSTATUSØBAR  IF NF$="" THEN GOSUB BUILDØSTATUSØBAR:GOSUB REDRAWØSCREEN:RETURN  PV$=CURRØFILE$:PV=YØPOS:CURRØFILE$=NF$:PRINT "{RVON}LOADING "+CURRØFILE$+"...";  GOSUB LOADØFILE  PRINT "{HOME}{HOME}{CLR}"+FORMATØOFF$;  GOSUB REDRAWØSCREEN ' REDRAW SCREEN  IF DISKØERRNO=0 THEN GOSUB SAVEØFILENAMEØINØMAILBOX  ' PERSIST FILENAME  GOSUB CLEARØSTATUSØBAR : FOREGROUND DISKØOPØRESULTØCLR(ABS(DISKØERRNO=0))  PRINT "{RVON}";CURRØFILE$;" - ";DISKØOPØRESULT$(ABS(DISKØERRNO=0));DISKØERROR$;" ";:FOREGROUND SB  IF DISKØERRNO=0 THEN PRINT "{RVON}; READ ";LASTLINEØY; "LINES.";  REDRAWØSTATUS=1  RETURN.SAVEØFILEØPROMPT'----------------  GOSUB CLEARØSTATUSØBAR:PRINT "{RVON}SAVE FILE NAME (RETURN TO CANCEL) "+CHR$(27)+"T{CLR}";  NF$=""  LINE INPUT "";NF$  PRINT "{HOME}{HOME}";:GOSUB CLEARØSTATUSØBAR  CURRØFILE$=NF$  RETURN.SAFEØLY'-------'--- ENSURE LY IS AT SANE POSITION END'     MAKE LINE LY THE CURRENT LINE  ' IF LY>LASTLINEØY-STATUSØLINEØY THEN LY=LASTLINEØY-STATUSØLINEØY  YØOFFS=LY :YØPOS=LY  IF YØOFFS>CONTEXTØLINES THEN YØOFFS=YØOFFS-CONTEXTØLINES  GOTO SLØSKIP  IF YØOFFS<0 THEN YØOFFS=0  IF YØPOS<0 THEN YØPOS=0  IF YØPOS>LASTLINEØY THEN YØPOS=LASTLINEØY : YØOFFS=YØPOS-STATUSØLINEØY+3  IF YØOFFS>CONTEXTØLINES THEN YØOFFS=YØOFFS-CONTEXTØLINES  ' CONTEXT LINES  IF YØOFFS<0 THEN YØOFFS=0.SLØSKIP  GOSUB REDRAWØSCREEN  RETURN.JUMPØTOØLINE'------------' --- QUERY LINE NO  GOSUB CLEARØSTATUSØBAR:PRINT "{RVON}JUMP TO LINE # (RETURN TO CANCEL) "+CHR$(27)+"T{CLR}";  NN$="":LINE INPUT NN$  NN=VAL(NN$):PRINT "{HOME}{HOME}";:GOSUB CLEARØSTATUSØBAR  IF NN>LASTLINEØY THEN RETURN  LY=NN:CONTEXTØLINES=8:GOSUB SAFEØLY  GOSUB BUILDØSTATUSØBAR  RETURN.SHOWØHELP'---------' --- HELP  PRINT "{HOME}{HOME}{CLR}-- CURSOR MOVEMENT --",,"-- EDITOR FUNCTIONS --{DOWN}"  PRINT "{RVON}CURSOR KEYS  {RVOF} MOVE THE CURSOR"  PRINT "{RVON}ALT + UP     {RVOF} SCROLL UP 1 PAGE"  PRINT "{RVON}ALT + DOWN   {RVOF} SCROLL DOWN 1 PAGE"  PRINT "{RVON}ALT + LEFT {$A0} {RVOF} SCROLL LEFT 1 CHAR(*)"  PRINT "{RVON}ALT + RIGHT  {RVOF} SCROLL RIGHT 1 CHAR(*)"  PRINT "{DOWN}{RVON}SHIFT + CLR  {RVOF} GO TO TOP OF FILE"  PRINT "{RVON}ALT + CLR    {RVOF} GO TO END OF FILE"  PRINT "{DOWN}{RVON}ALT + DELETE {RVOF} DELETE CURRENT LINE"  PRINT "{DOWN}{RVON}ALT + RETURN {RVOF} TO START OF NEXT LINE"  PRINT "{DOWN}{RVON}ALT + F      {RVOF} FIND"  PRINT "{RVON}ALT + R      {RVOF} FIND & REPLACE"  PRINT "{RVON}ALT + Z      {RVOF} GO TO LABEL UNDER CURSOR"  PRINT "{DOWN}*) ONLY IN LINES WITH >80 CHARACTERS"  PRINT "{DOWN}{RVON}#{RVOF}) XEMU-EQUIVALENT SHORTCUT KEY"  PRINT "{HOME}{DOWN}{DOWN}",,,,"{RVON} F1 {RVOF} LOAD FILE"  PRINT ,,,,"{RVON} F2 {RVOF} NEW FILE"  PRINT ,,,,"{RVON} F3 {RVOF} SAVE FILE"  PRINT ,,,,"{RVON} F4 {RVOF} SAVE FILE AS"  PRINT ,,,,"{DOWN}{RVON} F5 {RVOF} COMPILE + RUN"  PRINT ,,,,"{RVON} F6 {RVOF} JUST COMPILE"  PRINT ,,,,"{DOWN}{RVON} F7 {RVOF} GO TO LABEL"  PRINT ,,,,"{RVON} F8 {RVOF} GO TO PREVIOUS FILE"  PRINT ,,,,"{RVON} F9 {RVOF} GO TO LINE NR     ({RVON}#{RVOF})CTRL + P"  PRINT ,,,,"{RVON}CTRL-O{RVOF} JUMP TO LOC PRIOR TO F7"  PRINT ,,,,"{DOWN}{RVON}F11 {RVOF} TOGGLE CTRL MODE  ({RVON}#{RVOF})CTRL + 5"  PRINT ,,,,"{DOWN}{RVON}F14 {RVOF} UPDATE DEFAULTS   ({RVON}#{RVOF})CTRL + Z"  PRINT ,,,,"{DOWN}{RVON}HELP{RVOF} THIS SCREEN       ({RVON}#{RVOF})PAGEUP"  GOSUB MOREØHELP  ' MORE HELP  GOSUB CLEARØSTATUSØBAR :PRINT "{RVON}EE CHEAT SHEET -- PRESS ANY KEY TO RETURN TO EDITOR{RVOF}";  GET KEY T$:GOSUB REDRAWØSCREEN:GOSUB BUILDØSTATUSØBAR:RETURN.READØDEFAULTSØFROMØMAILBOX'--------------------------' --- SET FILENAME FROM MAILBOX RAM  BANK 4:T$=CHR$(PEEK(DEC("FF00")))+CHR$(PEEK(DEC("FF01")))  IF T$<>"SK" THEN BO=6:FG=5:BG=0:SB=14:HL=2:JUMPØLINE=-1:RETURN  JUMPØLINE=-1  ' JUMP LINE  AL=PEEK(DEC("FF07"))AND1  ' AUTOLOAD FLAG?  IF AL=0 THEN GOTO SKIPØAUTOLOAD  TF$="":I=DEC("FF10"):DO WHILE PEEK(I)<>0  TF$=TF$+CHR$(PEEK(I)):I=I+1:LOOP  CURRØFILE$=TF$  IF PEEK(DEC("FF07"))AND2 THEN BEGIN  ' AUTOJUMP FLAG  POKE DEC("FF07"),PEEK(DEC("FF07"))AND(255 XOR 2)  JUMPØLINE=PEEK(DEC("FF09"))+256*PEEK(DEC("FF0A")):EE=PEEK(DEC("FF08"))  BEND.SKIPØAUTOLOAD  BO=PEEK(DEC("FF02")):BG=PEEK(DEC("FF03")):FG=PEEK(DEC("FF04"))  HL=PEEK(DEC("FF05")):SB=PEEK(DEC("FF06"))  BU=PEEK(DEC("FF07"))AND4  ' BACKUP FLAG  ' SEEMS LIKE UBIK HAS PLANS TO SWITCH BETWEEN 80X25 AND 80X50 MODE THIS WAY  ' …'LL COMMENT IT OUT FOR NOW  ' SM=PEEK($4FF07)AND8:IF SM THEN PRINT CHR$(27)+"5";:ELSE PRINT CHR$(27)+"8"  BANK 128  RETURN.NEWØFILE'--------  IF CH THEN BEGIN    GOSUB CLEARØSTATUSØBAR:PRINT "{RVON}√URRENT FILE WAS MODIFIED! “EALLY START OVER (Y/N)? {√‘“Ã-œ}{√¬Õ-+}";    DO:GET KEY T$:LOOP UNTIL T$="Y" OR T$="N"    IF T$="N" THEN GOSUB BUILDØSTATUSØBAR:    RETURN  BEND  FOR A = 0 TO MAXØLINES:LINEØBUFF$(A)="":NEXT A:LC=0  CURRØFILE$=""  PRINT "{HOME}{HOME}{CLR}":GOSUB REDRAWØSCREEN  GOSUB BUILDØSTATUSØBAR  CHANGED=0:XØPOS=0:YØPOS=0:YØOFFS=0  GOSUB CLEARØSTATUSØBAR:PRINT "{RVON}** ŒEW FILE **{RVOF}";:REDRAWØSTATUS=1  RETURN.QUITØEE'-------  GOSUB CLEARØSTATUSØBAR:PRINT "{RVON}REALLY QUIT EE? {√‘“Ã-œ}{√¬Õ-+}"+CHR$(27)+"O";  DO:GET KEY T$:LOOP UNTIL T$="Y" OR T$="N"  IF T$="N" THEN GOSUB BUILDØSTATUSØBAR:RETURN  BANK 128:POKE248,0:KEY ON:PALETTE RESTORE  PRINT "{HOME}{HOME}{CLR}TSCHUESSN...!"  END.FILTERØLABELS'-------------'--- FILTER LABELS BASED ON FZ$  FOR A=0 TO 72:FILTEREDØNAME$(A)="":FILTEREDØLINENO(A)=0:NEXT A:FZ=0:MP=-1  FOR A=0 TO MN-1:IF (LEN(FZ$)>0 AND INSTR(LABELØNAME$(A),FZ$)>0)OR LEN(FZ$)=0 THEN BEGIN    FILTEREDØNAME$(FZ)=LABELØNAME$(A):FILTEREDØLINENO(FZ)=LABELØLINENO(A):FZ=FZ+1    IF LABELØLINENO(A) <= YØPOS THEN MP=MP+1  BEND  NEXT A:PRINT "{HOME}{HOME}{CLR}";:GOSUB CLEARØSTATUSØBAR:IF FZ<>0 THEN PRINT "{RVON}√HOOSE LABEL WITH CURSOR KEYS + “≈‘’“Œ, ESCAPE WITH ≈”√{RVOF} - FILTER='";FZ$;"'";  IF FZ=0 THEN PRINT "{RVON}{√‘“Ã-œ}ŒO LABELS FOUND{RVOF} - FILTER='";FZ$;"'"+FORMATØOFF$;:REDRAWØSTATUS=1:RETURN  L=STATUSØLINEØY+1:WINDOW0,0,79,STATUSØLINEØY:PRINT "{CLR}":FOR A=0 TO FZ:CURSOR 20*INT(A/L),MOD(A,L):PRINT FILTEREDØNAME$(A);:NEXT A:IF MP<0 THEN MP=0:RETURN:ELSE RETURN.SHOWØLABELS'-----------  MP = 0  BANK 1  GOSUB CLEARØSTATUSØBAR:PRINT "{RVON}√OLLECTING LABELS...";:IF NZ%=0 THEN FZ$=""  FOR A=0 TO 72:LABELØNAME$(A)="":LABELØLINENO(A)=0:FILTEREDØNAME$(A)="":FILTEREDØLINENO(A)=0:NEXT A:MN=0:FZ=0  FOR A=0 TO LASTLINEØY:T$=LINEØBUFF$(A):LB$="":IF LEFT$(T$,1)<>"." THEN 7490  LABELØNAME$(MN)=MID$(T$,1,38):LABELØLINENO(MN)=A:MN=MN+1  NEXT  GOSUB CLEARØSTATUSØBAR:GOSUB FILTERØLABELS  IF NZ%=1 THEN BEGIN    IF FZ=1 THEN T$=CHR$(13):ELSE T$=CHR$(27)    NZ%=0:GOTO SLBLØSKIP  BEND  NZ%=0  DO    SX=20*INT(MP/L): SY=MOD(MP,L):CURSOR 0,10    CURSOR SX,SY:PRINT "{RVON}";FILTEREDØNAME$(MP);"{RVOF}";    GET KEY T$    CURSOR SX,SY:PRINT FILTEREDØNAME$(MP);    IF T$="{DOWN}" THEN MP=MP+1    IF T$="{RGHT}" THEN MP=MP+L   IF T$="{UP}" THEN MP=MP-1   IF T$="{LEFT}" THEN MP=MP-L   IF (T$>="A" AND T$<="Z") OR T$="{√¬Õ-–}" THEN FZ$=FZ$+T$:GOSUB FILTERØLABELS   IF T$=CHR$(20) AND LEN(FZ$)>0 THEN FZ$=LEFT$(FZ$,LEN(FZ$)-1):GOSUB FILTERØLABELS   IF MP>FZ-1 THEN MP=FZ-1    IF MP<0 THEN MP=0  LOOP UNTIL T$=CHR$(13) OR T$=CHR$(27).SLBLØSKIP  IF T$=CHR$(13) THEN LASTØXPOS=XØPOS:LASTØYPOS=YØPOS:LASTØYOFFS=YØOFFS:XØPOS=0:LY=FILTEREDØLINENO(MP):GOSUB SAFEØLY:ELSE GOSUB REDRAWØSCREEN  GOSUB BUILDØSTATUSØBAR ' REDRAW STATUS BAR  RETURN.SAVEØFILENAMEØINØMAILBOX'------------------------  GOSUB COPYØLINEØBUFFERØTOØATTICØRAM  ' SAVE TO ATTIC  FOR I=1 TO LEN(CURRØFILE$):POKE $4FF10+I-1,ASC(MID$(CURRØFILE$,I,1)):NEXT I  POKE $4FF10+I-1,0  POKE $4FF00,ASC("S"),ASC("K")  POKE $4FF07,PEEK($4FF07)OR1  BANK 128:RETURN.COMPILE'-------  AB=0  IF CURRØFILE$="" THEN RETURN  ' NOW FILENAME, NO CIGAR  IF CHANGED=1 THEN BEGIN    GOSUB CLEARØSTATUSØBAR: FOREGROUND HL    PRINT "{RVON}CURRENT FILE NOT SAVED - PRESS ANY KEY";:GET KEY T$    FOREGROUND FG: GOSUB BUILDØSTATUSØBAR: AB=1  BEND  IF AB=1 THEN RETURN  PRINT "{HOME}{HOME}{CLR}"+CHR$(27)+"L";  IF PROJECTØFLAG% THEN GOSUB COPYØPROJECTØFILESØTOØATTICØRAM  PRINT "{HOME}{HOME}{CLR}{DOWN}{DOWN}EDMA 0,$D400,$8010000,$2001:NEW RESTORE{DOWN}{DOWN}":PRINT "RUN{HOME}"; ' LOAD '11.PARSE' FROM ATTIC CACHE  BANK 128  POKE 208,2      ' NO OF CHARS IN KEYBOARD BUFFER  POKE 688,13,13  ' 2X RETURN  END.MLØHELPER'---------'--- M/L HELPER FOR VIC-IV MODE  BANK128:RESTORE 7970  FOR I=0 TO 12:READ A$:POKE DEC("1600")+I,DEC(A$):NEXT I  DATA 78,A2,47,A0,53,8E,2F,D0,8C,2F,D0,58,60  MLØV4=DEC("1600")  RETURN.FINDØREPLACE'------------  ' FIND AND REPLACE  GOSUB CLEARØSTATUSØBAR:PRINT "{RVON}FIND:"+CHR$(27)+"T{CLR}";  FS$="":RS$="":SD=1  ' FIND STRING, REPLACE STRING, SEARCH DIR  RA%=0  ' REPLACE ALL  OPEN 1,0,0:LINE INPUT#1,FS$:CLOSE 1  IF FR%=0 THEN8110    PRINT "{HOME}{HOME}";:GOSUB CLEARØSTATUSØBAR:PRINT "{RVON}REPLACE:"+CHR$(27)+"T{CLR}";    OPEN 1,0,0:LINE INPUT#1,RS$:CLOSE 1  PRINT "{HOME}{HOME}";:GOSUB CLEARØSTATUSØBAR  IF FS$="" OR FS$=" " THEN PRINT "{RVON}FIND CANCELLED.";:REDRAWØSTATUS=1:RETURN  S=YØPOS.FNRØRETRY  GOSUB CLEARØSTATUSØBAR:PRINT "SEARCHING...";  DO WHILE S>=0 AND S<=LASTLINEØY    FP=INSTR(LINEØBUFF$(S),FS$)  ' FOUND POS    IF FP=0 THEN8240       LY=S:CONTEXTØLINES=8: GOSUB SAFEØLY       BANK 128       ' MARK FOUND LINE       FOR RV=0 TO 79         I=((YØPOS-YØOFFS)*80)+RV         POKE 2048+I,PEEK(2048+I) XOR 128       NEXT RV       ' FLASH FOUND STRING       FOR RV=0 TO LEN(FS$)-1         I=((YØPOS-YØOFFS)*80)+FP+RV-1         POKE $D800+I,PEEK($D800+I) OR 16       NEXT RV       IF FR%=0 THEN GOSUB FINDØNEXT : ELSE GOSUB REPLACE    S=S+SD  LOOP  IF FD$="Q" THEN GOSUB BUILDØSTATUSØBAR: ELSE GOSUB CLEARØSTATUSØBAR:FOREGROUND HL:PRINT "{RVON}END OF FOUND";:REDRAWØSTATUS=1  IF FD$<>"Q" AND S>LASTLINEØY THEN PRINT " - SEARCH FROM START?{$A0}(Y/N):";:GET KEY FD$: IF FD$="Y" THEN S=0:GOTO FNRØRETRY:ELSE GOSUB CLEARØSTATUSØBAR  XØPOS=0:CURSOR XØPOS,YØPOS-YØOFFS:PRINT CHR$(27)+"Q";  FOREGROUND FG  A$=LINEØBUFF$(YØPOS):GOSUB DRAWØTEXTØLINE ' REDRAW CURRENT  RETURN.FINDØNEXT'---------  BANK 128  GOSUB CLEARØSTATUSØBAR:PRINT "{RVON}FIND N)EXT P)REV Q)UIT";  DO:GET KEY FD$:LOOP UNTIL INSTR("NPQ",FD$)  IF FD$="N" THEN SD=1  IF FD$="P" THEN SD=-1  IF FD$="Q" THEN S=LASTLINEØY+2  RETURN.REPLACE'-------  BANK 128  GOSUB CLEARØSTATUSØBAR:PRINT "{RVON}R)EPLACE A)LL N)EXT P)REV Q)UIT";  DO:GET KEY FD$:LOOP UNTIL INSTR("RANPQ",FD$)  IF FD$="N" THEN SD=1  IF FD$="P" THEN SD=-1  IF FD$="Q" THEN S=LASTLINEØY+1  IF FD$="R" THEN GOSUB REPLACEØITEM  RETURN.REPLACEØITEM'------------  TS$=LINEØBUFF$(S)  NS$=LEFT$(TS$,FP-1)+RS$+MID$(TS$,FP+LEN(FS$),255)  LINEØBUFF$(S)=NS$  CURSOR XØPOS,YØPOS-YØOFFS:PRINT CHR$(27)+"Q";  A$=LINEØBUFF$(S):GOSUB DRAWØTEXTØLINE  S=S-1  RETURN.ERRORØHANDLER'-------------  IF ER=30 THEN RESUME  TRAP  BANK 128:POKE248,0:KEY ON:PALETTE RESTORE  PRINT CHR$(27)+"Q"+CHR$(27)+"L{HOME}{HOME}{LGRN}";ERR$(ER),EL  END.COPYØPROJECTØFILESØTOØATTICØRAM'-------------------------------  CURRØFILE$ = PROJØNAME$  GOSUB SAVEØFILENAMEØINØMAILBOX  ' TO ASSURE WE RETURN HERE AFTER COMPILATION  CB=$8030000 : C = CB  TOTALØPROJØLINES = 0  WPOKE CB, 0  ' RESET TOTAL LENGTH  C = C + 2  FOR FIDX = 0 TO PROJØFILEØIDX%-1    CURRØFILE$ = PROJØFILES$(FIDX)    GOSUB LOADØFILE    IF DISKØERRNO=0 THEN BEGIN      TOTALØPROJØLINES = TOTALØPROJØLINES + LASTLINEØY+1      WPOKE CB, TOTALØPROJØLINES      GOSUB COPYØMOREØTOØATTICØRAM  ' PERSIST FILENAME    BEND  NEXT FIDX  RETURN.COPYØLINEØBUFFERØTOØATTICØRAM'-----------------------------  CB=$8030000 : C=CB  WPOKE C,LASTLINEØY+1 : C=C+2  ' STORE NO OF LINES.COPYØMOREØTOØATTICØRAM  FOR A=0 TO LASTLINEØY    P=POINTER(LINEØBUFF$(A)):L=LEN(LINEØBUFF$(A)):B=$10000+WPEEK(P+1)    POKE C,L : C=C+1    IF L<>0 THEN EDMA 0,L,B,C:C=C+L  NEXT  RETURN.COPYØATTICØRAMØTOØLINEØBUFFER'-----------------------------  CB=$8030000 : C=CB  LASTLINEØY=WPEEK(C):C=C+2  CL=0  DO WHILE CL<>LASTLINEØY    L=PEEK(C):LINEØBUFF$(CL)=LEFT$(BLANKØLINE$,L):P=POINTER(LINEØBUFF$(CL))    B=$10000+WPEEK(P+1):C=C+1    IF L<>0 THEN EDMA 0,L,C,B : C=C+L    CL=CL+1  LOOP  RETURN.POSTØFILEØTOØPC'---------------  BLOAD "B65SUPPORT.BIN":SYS $1600  A=USR(0) ' SET ISSUE# TO ZERO  L$="/FILE:"+CURRØFILE$:GOSUB POSTØCHUNK  ' POST FILENAME  DOPEN#2,(CURRØFILE$)  L$="".POSTØLOOP  GET #2,C$  L$=L$+C$  IF LEN(L$)=128 THEN GOSUB POSTØCHUNK  ' POST CHUNK  PRINT N$;  IF NOT ST AND 64 THEN POSTØLOOP  DCLOSE#2  IF LEN(L$)<>0 THEN GOSUB POSTØCHUNK  ' POST REMAINING CHUNK  GOSUB POSTØCHUNK  ' POST EMPTY CHUNK TO DECLARE WE'VE FINISHED  PRINT "FINISHED POSTING!"  RETURN.POSTØCHUNK'----------  ' *** POST CHUNK ***  L$=CHR$(LEN(L$)+1) + L$ ' PREPEND THE LENGTH OF STRING+1  A=USR("/"+L$)  PRINT "POSTING CHUNK..."  L$=""  RETURN.NEXTØWORD'---------  ' MOVE TO NEXT WORD  DO WHILE MID$(CURRØLINE$,XØPOS+XØOFFS,1) <> " "    GOSUB NEXTØCHAR    IF EF THEN EXIT  LOOP  DO WHILE MID$(CURRØLINE$,XØPOS+XØOFFS,1) = " "    GOSUB NEXTØCHAR    IF EF THEN EXIT  LOOP  RETURN.NEXTØCHAR'---------  ' MOVE TO NEXT CHAR  EF=0:XØPOS=XØPOS+1  IF XØPOS>LEN(CURRØLINE$) THEN BEGIN    IF YØPOS< LASTLINEØY THEN XØPOS=0:YØPOS=YØPOS+1:CURRØLINE$=LINEØBUFF$(YØPOS):IF YØPOS-YØOFFS>20 THEN GOSUB SCROLLØUP    EF=1  BEND  RETURN.PREVIOUSØWORD'-------------  ' MOVE TO PREVIOUS WORD  GOSUB PREVIOUSØCHAR  ' PREV CHAR  DO WHILE MID$(CURRØLINE$,XØPOS+XØOFFS,1) = " "    GOSUB PREVIOUSØCHAR    IF EF THEN EXIT  LOOP  DO WHILE MID$(CURRØLINE$,XØPOS+XØOFFS,1) <> " "    GOSUB PREVIOUSØCHAR    IF EF THEN EXIT  LOOP  GOSUB PREVIOUSØCHAR  ' NEXT CHAR  RETURN.PREVIOUSØCHAR'-------------  ' MOVE TO PREV CHAR  EF=0:XØPOS=XØPOS-1  IF XØPOS<0 THEN BEGIN    IF YØPOS>0 THEN YØPOS=YØPOS-1:CURRØLINE$=LINEØBUFF$(YØPOS):XØPOS=LEN(CURRØLINE$)-1:IF YØPOS-YØOFFS<0THEN GOSUB SCROLLØDOWN    IF XØPOS<0 THEN XØPOS=0    EF=1  BEND  IF EF=1 AND LEN(CURRØLINE$) AND YØPOS>0 THEN GOTO PREVIOUSØCHAR  RETURN.DELETEØCURRØCHAR'----------------  ' DELETE CURRENT CHAR  IF XØPOS<LEN(CURRØLINE$) THEN BEGIN    CHANGED=1    CURRØLINE$=LEFT$(CURRØLINE$,XØPOS+XØOFFS-1)+MID$(CURRØLINE$,XØPOS+XØOFFS+1)    LINEØBUFF$(YØPOS)=CURRØLINE$    GOSUB REDRAWØLINE  BEND  RETURN.REDRAWØLINE'-----------  IV=0:GOSUB INVERTØIFØMARKED  CURSOR 0,YØPOS-YØOFFS:A$=CURRØLINE$:GOSUB DRAWØTEXTØLINE:IF LEN(CURRØLINE$)<=79 THEN PRINT " ";  IV=0  RETURN.INVERTØIFØMARKED'----------------  IV=0:IF MF=0 THEN RETURN  IF MS<ME AND MS<=YØPOS AND YØPOS<=ME THEN IV=1:RETURN  IF ME<=MS AND ME<=YØPOS AND YØPOS<=MS THEN IV=1  RETURN.MARKØMODEØHANDLER'-----------------  IF T$="{DOWN}" THEN BEGIN    ME=YØPOS+1:CURRØLINE$=LINEØBUFF$(YØPOS):GOSUB REDRAWØLINE : YØPOS=YØPOS+1    IF YØPOS-YØOFFS>STATUSØLINEØY-3 THEN GOSUB SCROLLØUP :RETURN:ELSE BEGIN      CURRØLINE$=LINEØBUFF$(YØPOS):GOSUB REDRAWØLINE :RETURN    BEND  BEND  IF T$="{UP}" AND YØPOS>0 THEN BEGIN    ME=YØPOS-1:CURRØLINE$=LINEØBUFF$(YØPOS):GOSUB REDRAWØLINE :YØPOS=YØPOS-1    IF YØPOS-YØOFFS<0 THEN GOSUB SCROLLØDOWN :RETURN:ELSE BEGIN      CURRØLINE$=LINEØBUFF$(YØPOS):GOSUB REDRAWØLINE :RETURN    BEND  BEND  IF T$="X" OR T$="C" THEN BEGIN    IF MS>ME THEN IV=MS:MS=ME:ME=IV    FOR IV=ME TO MS STEP -1      CLIPBOARD$(IV-MS) = LINEØBUFF$(IV)    NEXT IV    IF T$="X" THEN BEGIN      FOR A=MS TO LASTLINEØY-(ME-MS+1)        LINEØBUFF$(A)=LINEØBUFF$(A+(ME-MS+1))      NEXT A      LASTLINEØY=LASTLINEØY-(ME-MS+1):FOR A=LASTLINEØY+1 TO LASTLINEØY+(ME-MS+1):LINEØBUFF$(A)="":NEXT A      YØPOS=MS:IF YØPOS-YØOFFS<0 THEN LY=MS:GOSUB SAFEØLY    BEND    IV=0:MF=0:CS=ME-MS+1:MS=0:ME=0  BEND  GOSUB  REDRAWØSCREEN  RETURN.PASTE'-----  FOR IV=CS-1 TO 0 STEP -1    ' INSERT A LINE AT YØPOS    MF=YØPOS ' TEMP    CHANGED=1:GOSUB INSERTØRETURN    YØPOS=MF:MF=0    LINEØBUFF$(YØPOS)=CLIPBOARD$(IV)  NEXT IV  GOSUB  REDRAWØSCREEN  RETURN.ENABLEØRAWØFNØKEYS'------------------'--- SET FN KEYS AND MAKE SURE F11 DOESN'T GENERATE PASTE  KEY ON  FK$="{F1}{F2}{F3}{F4}{F5}{F6}{F7}{F8}{√‘“Ã-–}{√‘“Ã-’}{PUR}{√‘“Ã-◊}{√‘“Ã-Ÿ}{√‘“Ã-⁄}"+CHR$(132)  FOR R=1 TO 15:KEY R, MID$(FK$,R,1):NEXT R  RETURN.MOREØHELP'---------  IF RWINDOW(1)=25 THEN PRINT "{RVON}-- PRESS ANY KEY FOR NEXT PAGE{RVOF}";:GET KEYT$:PRINT "{HOME}{HOME}{CLR}";:GOSUB CLEARØSTATUSØBAR:ELSE PRINT "{DOWN}{DOWN}{DOWN}";  PRINT "{RVON}ALT + P{RVOF} POST TO PC (M65POSTBOX)"  PRINT "{RVON}ESC, J{RVOF} GO TO START OF LINE"  PRINT "{RVON}ESC, K{RVOF} GO TO END OF LINE"  PRINT "{RVON}ESC, D{RVOF} DELETE CURRENT LINE"  PRINT "{RVON}CTRL + W{RVOF} MOVE TO NEXT WORD"  PRINT "{RVON}CTRL + U{RVOF} MOVE TO PREVIOUS WORD"  PRINT "{RVON}SHIFT + INST/DEL{RVOF} DELETE CURRENT CHARACTER"  PRINT "{RVON}CTRL + ={RVOF} TOGGLE COMPILATION DEBUGGING ON/OFF"  PRINT "{DOWN}{RVON}ESC, M{RVOF} TURN 'MARK-MODE' ON"  PRINT "  - WHEN 'MARK-MODE' IS ON, USE CURSOR UP/DOWN TO SELECT LINES"  PRINT "  - PRESS '{RVON}X{RVOF}' TO CUT"  PRINT "  - PRESS '{RVON}C{RVOF}' TO COPY"  PRINT "  - ‘HEN USE {RVON}ESC,P{RVOF} TO PASTE CLIPBOARD CONTENTS"  RETURN.JUMPØTOØPREVØFILE'-----------------  IF CHANGED=1 THEN BEGIN    GOSUB CLEARØSTATUSØBAR:FOREGROUND HL    PRINT "{RVON}CURRENT FILE NOT SAVED - PRESS ANY KEY";:GET KEY T$    GOSUB CLEARØSTATUSØBAR:GOSUB BUILDØSTATUSØBAR:RETURN  BEND  TEMP=PV:NF$=PV$:GOSUB LOADØSPECIFIEDØFILE  LY=TEMP:GOSUB SAFEØLY  RETURN.NAVIGATEØTOØLABELØUNDERØCURSOR'------------------------------  GOSUB GETØTERMØUNDERØCURSOR  ' GET TERM UNDER CURSOR  NZ%=1 ' NAV TO LABEL FLAG = TRUE  GOSUB SHOWØLABELS  ' GOSUB FIND LABEL SCREEN  RETURN.GETØTERMØUNDERØCURSOR'---------------------  '--- GET TERM UNDER CURSOR INTO FZ$  GOSUB GETØSTARTØOFØLABEL  ' START OF LABEL INTO SZ  GOSUB GETØENDØOFØLABEL  ' END OF LABEL INTO EZ  FZ$ = MID$(CURRØLINE$,SZ+1,EZ-SZ+1)  RETURN.GETØSTARTØOFØLABEL'------------------  '--- GET START OF LABEL INTO SZ  K = XØPOS - 1 : ZZ$=" :" : SZ = 0  DO WHILE K >= 0    IF INSTR(ZZ$,MID$(CURRØLINE$,K+1,1)) THEN SZ = K + 1 : EXIT    K = K - 1  LOOP  RETURN.GETØENDØOFØLABEL'----------------  '--- GET END OF LABEL INTO EZ  K = XØPOS : ZZ$=" :" : EZ = LEN(CURRØLINE$)-1  DO WHILE K <= EZ    IF INSTR(ZZ$,MID$(CURRØLINE$,K+1,1)) THEN EZ = K - 1 : EXIT    K = K + 1  LOOP  RETURNˇ